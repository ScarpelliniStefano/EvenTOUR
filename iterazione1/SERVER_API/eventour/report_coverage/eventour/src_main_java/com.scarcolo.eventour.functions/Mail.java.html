<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>Mail.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">java (30 dic 2021 11:03:38)</a> &gt; <a href="../../index.html" class="el_group">eventour</a> &gt; <a href="../index.html" class="el_bundle">src/main/java</a> &gt; <a href="index.source.html" class="el_package">com.scarcolo.eventour.functions</a> &gt; <span class="el_source">Mail.java</span></div><h1>Mail.java</h1><pre class="source lang-java linenums">package com.scarcolo.eventour.functions;

import java.util.Properties;
import javax.mail.Authenticator;
import javax.mail.Message;
import javax.mail.MessagingException;
import javax.mail.Multipart;
import javax.mail.PasswordAuthentication;
import javax.mail.Session;
import javax.mail.Transport;
import javax.mail.internet.InternetAddress;
import javax.mail.internet.MimeBodyPart;
import javax.mail.internet.MimeMessage;
import javax.mail.internet.MimeMultipart;

import com.scarcolo.eventour.model.event.Event;

// TODO: Auto-generated Javadoc
/**
 * The Class Mail.
 */
<span class="nc" id="L22">public class Mail {</span>
	
	/** The properties. */
	static Properties prop;
	
	/**
	 * The generic send mail function.
	 *
	 * @param destination the destination address
	 * @param obj the object of a password
	 * @param msg the message to send
	 * @throws MessagingException the messaging exception
	 */
	private static void sendMail(String destination, String obj, String msg) throws MessagingException
	{
<span class="fc" id="L37">		prop = new Properties();</span>
<span class="fc" id="L38">		prop.put(&quot;mail.smtp.auth&quot;, true);</span>
<span class="fc" id="L39">		prop.put(&quot;mail.smtp.starttls.enable&quot;, &quot;true&quot;);</span>
<span class="fc" id="L40">		prop.put(&quot;mail.smtp.host&quot;, &quot;smtp.mailtrap.io&quot;);</span>
<span class="fc" id="L41">		prop.put(&quot;mail.smtp.port&quot;, &quot;25&quot;);</span>
<span class="fc" id="L42">		prop.put(&quot;mail.smtp.ssl.trust&quot;, &quot;smtp.mailtrap.io&quot;);</span>
<span class="fc" id="L43">		Session session = Session.getInstance(prop, new Authenticator() {</span>
		    @Override
		    protected PasswordAuthentication getPasswordAuthentication() {
<span class="fc" id="L46">		        return new PasswordAuthentication(&quot;88037fa3d5088f&quot;, &quot;45768831cff825&quot;);</span>
		    }
		});
		
<span class="fc" id="L50">		Message message = new MimeMessage(session);</span>
<span class="fc" id="L51">		message.setFrom(new InternetAddress(&quot;eventourcs@gmail.com&quot;));</span>
<span class="fc" id="L52">		message.setRecipients(</span>
<span class="fc" id="L53">		  Message.RecipientType.TO, InternetAddress.parse(destination));</span>
<span class="fc" id="L54">		message.setSubject(obj);</span>

<span class="fc" id="L56">		MimeBodyPart mimeBodyPart = new MimeBodyPart();</span>
<span class="fc" id="L57">		mimeBodyPart.setContent(msg, &quot;text/html; charset=utf-8&quot;);</span>

<span class="fc" id="L59">		Multipart multipart = new MimeMultipart();</span>
<span class="fc" id="L60">		multipart.addBodyPart(mimeBodyPart);</span>

<span class="fc" id="L62">		message.setContent(multipart);</span>

<span class="fc" id="L64">		Transport.send(message);</span>
<span class="fc" id="L65">	}</span>
	
	/**
	 * Send delete event mail.
	 *
	 * @param destination the destination address
	 * @param event the event data
	 * @return true, if successful
	 */
	public static boolean sendDeleteEventMsg(String destination, Event event){
<span class="fc" id="L75">		String hh=(&quot;0&quot;+event.getDataOra().getHour());</span>
<span class="fc" id="L76">		String mm=(&quot;0&quot;+event.getDataOra().getMinute());</span>
<span class="fc" id="L77">		String msg = &quot;Ciao, purtroppo dobbiamo informarti che l'evento \&quot;&quot;+</span>
<span class="fc" id="L78">				  event.getTitle()+</span>
<span class="fc" id="L79">				  &quot;\&quot; che si svolge in data &quot; +</span>
<span class="fc" id="L80">				  event.getDataOra().getDayOfMonth() + &quot;/&quot;+event.getDataOra().getMonthValue()+&quot;/&quot;+event.getDataOra().getYear()+</span>
<span class="fc" id="L81">				  &quot; alle ore &quot;+hh.substring(hh.length()-2)+&quot;:&quot;+mm.substring(mm.length()-2)+</span>
<span class="fc" id="L82">				  &quot; e' stato cancellato dall'organizzatore. &lt;br&gt;&quot;;</span>
<span class="pc bpc" id="L83" title="1 of 2 branches missed.">				  if(event.getPrice()&gt;0){msg+=&quot;Il rimborso del biglietto verr√† effettuato nei prossimi giorni.&lt;br&gt;&lt;br&gt;&quot;;}</span>
<span class="fc" id="L84">				  msg+=&quot;Buona giornata&lt;br&gt;&lt;br&gt; &lt;b&gt;Il team evenTour&lt;b&gt;&quot;;</span>
		
		try{
<span class="fc" id="L87">			sendMail(destination,&quot;Cancellazione evento &quot;+event.getTitle(),msg);</span>
<span class="fc" id="L88">			return true;</span>
<span class="nc" id="L89">		} catch (MessagingException e) {</span>
<span class="nc" id="L90">			return false;</span>
		}
	}
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span>java (30 dic 2021 11:03:38)</div></body></html>