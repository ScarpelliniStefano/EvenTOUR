<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>EventService.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">java (1) (30 dic 2021 11:07:32)</a> &gt; <a href="../../index.html" class="el_group">eventour</a> &gt; <a href="../index.html" class="el_bundle">src/main/java</a> &gt; <a href="index.source.html" class="el_package">com.scarcolo.eventour.service.event</a> &gt; <span class="el_source">EventService.java</span></div><h1>EventService.java</h1><pre class="source lang-java linenums">package com.scarcolo.eventour.service.event;


import org.bson.types.ObjectId;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Sort;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;

import com.scarcolo.eventour.model.event.AddEventRequest;
import com.scarcolo.eventour.model.event.Event;
import com.scarcolo.eventour.model.event.EventResponse;
import com.scarcolo.eventour.repository.event.EventRepository;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Optional;


// TODO: Auto-generated Javadoc
/**
 * The Class EventService.
 */
@Service
<span class="fc" id="L30">public class EventService {</span>

    /** The event repository. */
    @Autowired
    private EventRepository eventRepository;

   
    /**
     * Add a event.
     *
     * @param request the request
     * @return the response entity
     * @throws Exception the exception
     */
    public ResponseEntity&lt;EventResponse&gt; add(AddEventRequest request){
        Event event;
		try {
<span class="fc" id="L47">			event = eventRepository.save(new Event(request));</span>
<span class="fc" id="L48">		} catch (Exception e) {</span>
<span class="fc" id="L49">			return new ResponseEntity&lt;&gt;(HttpStatus.NOT_ACCEPTABLE);</span>
		}
<span class="fc" id="L51">        return new ResponseEntity&lt;&gt;(new EventResponse(event), HttpStatus.OK);</span>
    }


   
    /**
     * Get a event by id.
     *
     * @param id the id
     * @return the event by id
     */
    public ResponseEntity&lt;EventResponse&gt; getById(String id) {
<span class="fc" id="L63">    	Optional&lt;Event&gt; eventData = eventRepository.findById(id);</span>

<span class="fc bfc" id="L65" title="All 2 branches covered.">  	  if (eventData.isPresent()) {</span>
<span class="fc" id="L66">  	    return new ResponseEntity&lt;&gt;(new EventResponse(eventData.get()), HttpStatus.OK);</span>
  	  } else {
<span class="fc" id="L68">  	    return new ResponseEntity&lt;&gt;(HttpStatus.NOT_FOUND);</span>
  	  }
    }

	/**
	 * Get all events.
	 *
	 * @param page the page
	 * @param size the size
	 * @param ordered the order
	 * @param param the parameter to order on
	 * @return all events ordered, if necessary, and divided by page of size
	 */
	public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; getAll(int page, int size, String ordered,String param) {
		try {
<span class="fc" id="L83">			List&lt;Event&gt; events = new ArrayList&lt;&gt;();</span>
			
<span class="fc" id="L85">			Pageable paging = PageRequest.of(page, size);</span>
			
			Page&lt;Event&gt; pageEvents;
<span class="fc bfc" id="L88" title="All 2 branches covered.">			if(param==null)</span>
<span class="fc" id="L89">					pageEvents=eventRepository.findAllFuture(paging);</span>
			else {
<span class="pc bpc" id="L91" title="1 of 2 branches missed.">				if(ordered.equalsIgnoreCase(&quot;desc&quot;)) {</span>
<span class="pc bpc" id="L92" title="1 of 2 branches missed.">					if(param.equals(&quot;dataOra&quot;)) {</span>
<span class="nc" id="L93">						paging = PageRequest.of(page, size,Sort.by(&quot;dataOra&quot;).descending());</span>
<span class="nc" id="L94">						pageEvents=eventRepository.findAllFuture(paging);</span>
<span class="pc bpc" id="L95" title="1 of 2 branches missed.">					}else if(param.equals(&quot;loc&quot;)) {</span>
<span class="fc" id="L96">						paging = PageRequest.of(page, size,Sort.by(&quot;location.regione&quot;,&quot;location.provincia&quot;,&quot;location.city&quot;).descending());</span>
<span class="fc" id="L97">						pageEvents=eventRepository.findAllFuture(paging);</span>
<span class="fc" id="L98">					}else { </span>
<span class="nc" id="L99">						paging = PageRequest.of(page, size,Sort.by(&quot;dataOra&quot;).descending());</span>
<span class="nc" id="L100">						pageEvents=eventRepository.findAllFuture(paging);</span>
					}
<span class="nc" id="L102">				}else {</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">					if(param.equalsIgnoreCase(&quot;dataOra&quot;)) {</span>
<span class="nc" id="L104">						paging = PageRequest.of(page, size,Sort.by(&quot;dataOra&quot;).ascending());</span>
<span class="nc" id="L105">						pageEvents=eventRepository.findAllFuture(paging);</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">					}else if(param.equals(&quot;loc&quot;)) {</span>
<span class="nc" id="L107">						paging = PageRequest.of(page, size,Sort.by(&quot;location.regione&quot;,&quot;location.provincia&quot;,&quot;location.city&quot;).ascending());</span>
<span class="nc" id="L108">						pageEvents=eventRepository.findAllFuture(paging);</span>
<span class="nc" id="L109">					}else {</span>
<span class="nc" id="L110">						paging = PageRequest.of(page, size,Sort.by(&quot;dataOra&quot;).ascending());</span>
<span class="nc" id="L111">						pageEvents=eventRepository.findAllFuture(paging);</span>
					}
				}
			} 
<span class="fc" id="L115">			events=pageEvents.getContent();	</span>
<span class="fc bfc" id="L116" title="All 2 branches covered.">			if(events.isEmpty()) {</span>
<span class="fc" id="L117">				return new ResponseEntity&lt;&gt;(HttpStatus.NO_CONTENT);</span>
			}
<span class="fc" id="L119">			List&lt;EventResponse&gt; eventR= new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L120" title="All 2 branches covered.">			for(Event event: events) eventR.add(new EventResponse(event));</span>
<span class="fc" id="L121">			Map&lt;String, Object&gt; response = new HashMap&lt;&gt;();</span>
<span class="fc" id="L122">			response.put(&quot;events&quot;, eventR);</span>
<span class="fc" id="L123">		    response.put(&quot;currentPage&quot;, pageEvents.getNumber());</span>
<span class="fc" id="L124">		    response.put(&quot;totalItems&quot;, pageEvents.getTotalElements());</span>
<span class="fc" id="L125">		    response.put(&quot;totalPages&quot;, pageEvents.getTotalPages());</span>
			
<span class="fc" id="L127">			return new ResponseEntity&lt;&gt;(response, HttpStatus.OK);</span>
<span class="nc" id="L128">		}catch(Exception e) {</span>
<span class="nc" id="L129">			return new ResponseEntity&lt;&gt;(HttpStatus.INTERNAL_SERVER_ERROR);</span>
		}
	}


	/**
	 * Gets all events by id manager.
	 *
	 * @param page the page
	 * @param size the size
	 * @param id the id manager
	 * @return page required of size with the events
	 */
	public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; getByIdMan(int page, int size, String id) {
		try {
<span class="fc" id="L144">			Pageable paging = PageRequest.of(page, size,Sort.by(&quot;dataOra&quot;).ascending());</span>
			Page&lt;Event&gt; pageEvents;
<span class="fc" id="L146">			pageEvents=eventRepository.findByManagerId(new ObjectId(id),paging);</span>
<span class="fc" id="L147">			List&lt;Event&gt; events=pageEvents.getContent();</span>
<span class="fc bfc" id="L148" title="All 2 branches covered.">			if(events.isEmpty()) {</span>
<span class="fc" id="L149">				return new ResponseEntity&lt;&gt;(HttpStatus.NO_CONTENT);</span>
			}
<span class="fc" id="L151">			List&lt;EventResponse&gt; eventR= new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L152" title="All 2 branches covered.">			for(Event event: events) {</span>
<span class="fc" id="L153">				eventR.add(new EventResponse(event));</span>
			}
<span class="fc" id="L155">			Map&lt;String, Object&gt; response = new HashMap&lt;&gt;();</span>
<span class="fc" id="L156">			response.put(&quot;events&quot;, eventR);</span>
<span class="fc" id="L157">			response.put(&quot;currentPage&quot;, pageEvents.getNumber());</span>
<span class="fc" id="L158">			response.put(&quot;totalItems&quot;, pageEvents.getTotalElements());</span>
<span class="fc" id="L159">			response.put(&quot;totalPages&quot;, pageEvents.getTotalPages());</span>
<span class="fc" id="L160">			return new ResponseEntity&lt;&gt;(response, HttpStatus.OK);</span>
<span class="nc" id="L161">		}catch(Exception e) {</span>
<span class="nc" id="L162">			return new ResponseEntity&lt;&gt;(HttpStatus.INTERNAL_SERVER_ERROR);</span>
		}
	}


	public boolean delete(String id) {
<span class="fc" id="L168">		Optional&lt;Event&gt; optionalEvent = eventRepository.findById(id);</span>
<span class="pc bpc" id="L169" title="1 of 2 branches missed.">        if (optionalEvent.isEmpty()) {</span>
<span class="nc" id="L170">            return false;</span>
        }
<span class="fc" id="L172">        eventRepository.deleteById(optionalEvent.get().getId());</span>
<span class="fc" id="L173">        return true;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span>java (1) (30 dic 2021 11:07:32)</div></body></html>